# سیستم تحلیل فیدبک‌ها بر اساس کلمات کلیدی

این سیستم به شما امکان می‌دهد تا کلمات کلیدی مهم و حساس را برای هر بخش تعریف کنید و بر اساس آن‌ها گزارشات تحلیلی دریافت کنید.

## ویژگی‌ها

### 1. مدیریت کلمات کلیدی
- تعریف کلمات کلیدی برای هر بخش یا به صورت عمومی
- دسته‌بندی کلمات بر اساس نوع:
  - **حساس**: کلماتی مانند "شکایت"، "مشکل"، "اعتراض"
  - **مثبت**: کلماتی مانند "عالی"، "خوب"، "ممنون"
  - **منفی**: کلماتی مانند "ضعیف"، "بد"، "نامناسب"
  - **موضوعی**: موضوعات خاص مانند "بهداشت"، "امنیت"، "نظافت"
  - **دلخواه**: کلمات سفارشی
- تعیین اولویت برای کلمات کلیدی
- فعال/غیرفعال کردن کلمات کلیدی

### 2. گزارشات تحلیلی

#### گزارش خلاصه
- تعداد کل فیدبک‌ها
- تعداد کلمات کلیدی یافت شده
- برترین کلمات کلیدی
- نمودار میله‌ای برترین کلمات
- نمودار دایره‌ای توزیع انواع کلمات
- جدول جزئیات همه کلمات کلیدی

#### گزارش روند
- نمودار خطی روند کلمات کلیدی در طول زمان
- قابلیت انتخاب بازه زمانی (7، 14، 30، 60، 90 روز)
- مقایسه روند چند کلمه کلیدی به صورت همزمان

#### گزارش مقایسه‌ای
- مقایسه بخش‌ها بر اساس تعداد فیدبک
- مقایسه توزیع انواع کلمات در بخش‌های مختلف
- نمودار میله‌ای برای مقایسه آسان

### 3. فیلترها
- فیلتر بر اساس بخش
- فیلتر بر اساس نوع کلمه
- فیلتر بر اساس بازه زمانی
- جستجوی کلمات کلیدی

## نحوه استفاده

### 1. تعریف کلمات کلیدی

1. وارد صفحه "آمار و گزارش‌ها > کلمات کلیدی" شوید
2. روی دکمه "افزودن کلمه کلیدی" کلیک کنید
3. فرم را پر کنید:
   - کلمه کلیدی را وارد کنید
   - نوع کلمه را انتخاب کنید
   - در صورت نیاز، بخش خاص را انتخاب کنید (یا آن را عمومی نگه دارید)
   - اولویت را تعیین کنید (عدد بزرگتر = اولویت بیشتر)
   - توضیحات اضافه کنید
4. روی "افزودن" کلیک کنید

### 2. مشاهده گزارشات

1. وارد صفحه "آمار و گزارش‌ها > گزارشات تحلیلی" شوید
2. نوع گزارش را انتخاب کنید:
   - خلاصه: برای مشاهده آمار کلی
   - روند: برای بررسی تغییرات در طول زمان
   - مقایسه: برای مقایسه بخش‌ها
3. فیلترهای مورد نظر را اعمال کنید
4. روی "بروزرسانی گزارش" کلیک کنید

## ساختار فایل‌ها

```
prisma/
  schema.prisma                         # Schema دیتابیس (model AnalyticsKeyword)

lib/
  analytics-utils.ts                    # توابع تحلیلی

app/
  api/
    analytics-keywords/
      route.ts                          # API مدیریت کلمات کلیدی (GET, POST)
      [id]/
        route.ts                        # API مدیریت کلمات کلیدی (GET, PUT, DELETE)
      report/
        route.ts                        # API گزارشات تحلیلی

  analytics-keywords/
    page.tsx                            # صفحه مدیریت کلمات کلیدی
    reports/
      page.tsx                          # صفحه گزارشات تحلیلی

components/
  Sidebar.tsx                           # منوی سایدبار (با لینک‌های جدید)
```

## API Endpoints

### مدیریت کلمات کلیدی

- `GET /api/analytics-keywords` - دریافت لیست کلمات کلیدی
  - Query params: `departmentId`, `type`, `isActive`

- `POST /api/analytics-keywords` - ایجاد کلمه کلیدی جدید
  - Body: `{ keyword, type, priority, description, isActive, departmentId }`

- `GET /api/analytics-keywords/[id]` - دریافت یک کلمه کلیدی

- `PUT /api/analytics-keywords/[id]` - ویرایش کلمه کلیدی

- `DELETE /api/analytics-keywords/[id]` - حذف کلمه کلیدی

### گزارشات تحلیلی

- `GET /api/analytics-keywords/report` - دریافت گزارش تحلیلی
  - Query params:
    - `type`: نوع گزارش (`summary`, `trends`, `comparison`)
    - `departmentId`: ID بخش (اختیاری)
    - `startDate`, `endDate`: بازه زمانی برای گزارش خلاصه
    - `days`: تعداد روز برای گزارش روند

## مثال‌های استفاده

### تعریف کلمات کلیدی برای بخش خاص

```javascript
POST /api/analytics-keywords
{
  "keyword": "نظافت",
  "type": "TOPIC",
  "priority": 10,
  "description": "موضوعات مربوط به نظافت",
  "isActive": true,
  "departmentId": "dept-123"
}
```

### دریافت گزارش خلاصه برای یک بخش

```javascript
GET /api/analytics-keywords/report?type=summary&departmentId=dept-123&startDate=2025-01-01&endDate=2025-01-31
```

### دریافت روند کلمات کلیدی در 30 روز گذشته

```javascript
GET /api/analytics-keywords/report?type=trends&days=30
```

### مقایسه بخش‌ها

```javascript
GET /api/analytics-keywords/report?type=comparison
```

## نکات مهم

1. **دسترسی**: فقط کاربران با نقش ADMIN می‌توانند کلمات کلیدی را مدیریت کنند
2. **گزارشات**: هم ADMIN و هم MANAGER می‌توانند گزارشات را مشاهده کنند
3. **کلمات عمومی**: کلمات کلیدی بدون بخش، برای همه بخش‌ها اعمال می‌شوند
4. **تحلیل**: تحلیل بر اساس جستجوی کلمات در عنوان و متن فیدبک‌ها انجام می‌شود
5. **حساسیت به حروف**: جستجو case-insensitive است

## توسعه‌های آینده (پیشنهادی)

- [ ] استفاده از AI برای استخراج خودکار کلمات کلیدی از فیدبک‌ها
- [ ] اعلان‌های خودکار هنگام یافت کلمات حساس
- [ ] export گزارشات به PDF/Excel
- [ ] تحلیل احساسات (Sentiment Analysis)
- [ ] پیشنهاد کلمات کلیدی بر اساس داده‌های موجود
- [ ] امکان استفاده از عبارات چند کلمه‌ای (phrases)
- [ ] مدیریت مترادف‌ها و کلمات مشابه
