generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model analytics_keywords {
  id           String          @id
  keyword      String
  type         KeywordType     @default(CUSTOM)
  description  String?
  isActive     Boolean         @default(true)
  departmentId String?
  createdAt    DateTime        @default(now())
  updatedAt    DateTime
  priority     KeywordPriority @default(MEDIUM)
  departments  departments?    @relation(fields: [departmentId], references: [id], onDelete: Cascade)

  @@index([departmentId])
  @@index([isActive])
  @@index([priority])
  @@index([type])
}

model announcement_messages {
  id             String        @id
  announcementId String
  content        String
  createdById    String
  createdAt      DateTime      @default(now())
  updatedAt      DateTime
  attachments    Json?
  announcements  announcements @relation(fields: [announcementId], references: [id], onDelete: Cascade)
  users          users         @relation(fields: [createdById], references: [id])

  @@index([announcementId])
}

model announcement_views {
  id             String        @id
  announcementId String
  userId         String
  viewedAt       DateTime      @default(now())
  announcements  announcements @relation(fields: [announcementId], references: [id], onDelete: Cascade)
  users          users         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([announcementId, userId])
  @@index([announcementId])
  @@index([userId])
}

model announcements {
  id                    String                  @id
  title                 String
  content               String
  priority              String?
  isActive              Boolean                 @default(true)
  scheduledAt           DateTime?
  publishedAt           DateTime?
  departmentId          String?
  createdById           String
  createdAt             DateTime                @default(now())
  updatedAt             DateTime
  attachments           Json?
  announcement_messages announcement_messages[]
  announcement_views    announcement_views[]
  users                 users                   @relation(fields: [createdById], references: [id])
  departments           departments?            @relation(fields: [departmentId], references: [id])
}

model assessment_assignments {
  id               String       @id
  assessmentId     String
  departmentId     String?
  isRequired       Boolean      @default(false)
  startDate        DateTime?
  endDate          DateTime?
  allowManagerView Boolean      @default(false)
  createdAt        DateTime     @default(now())
  assessments      assessments  @relation(fields: [assessmentId], references: [id], onDelete: Cascade)
  departments      departments? @relation(fields: [departmentId], references: [id], onDelete: Cascade)

  @@unique([assessmentId, departmentId])
  @@index([assessmentId])
  @@index([departmentId])
}

model assessment_progress {
  id           String      @id
  assessmentId String
  userId       String
  answers      Json
  lastQuestion Int         @default(0)
  startedAt    DateTime    @default(now())
  updatedAt    DateTime
  assessments  assessments @relation(fields: [assessmentId], references: [id], onDelete: Cascade)
  users        users       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([assessmentId, userId])
  @@index([userId])
}

model assessment_questions {
  id           String       @id
  assessmentId String
  questionText String
  questionType QuestionType
  order        Int
  isRequired   Boolean      @default(true)
  options      Json
  image        String?
  createdAt    DateTime     @default(now())
  assessments  assessments  @relation(fields: [assessmentId], references: [id], onDelete: Cascade)

  @@index([assessmentId, order])
}

model assessment_results {
  id           String      @id
  assessmentId String
  userId       String
  answers      Json
  result       Json
  score        Int?
  isPassed     Boolean?
  startedAt    DateTime
  completedAt  DateTime    @default(now())
  timeTaken    Int?
  assessments  assessments @relation(fields: [assessmentId], references: [id], onDelete: Cascade)
  users        users       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([assessmentId])
  @@index([completedAt])
  @@index([userId])
}

model assessments {
  id                     String                   @id
  title                  String
  description            String?
  type                   AssessmentType
  instructions           String?
  isActive               Boolean                  @default(true)
  allowRetake            Boolean                  @default(false)
  timeLimit              Int?
  passingScore           Int?
  showResults            Boolean                  @default(true)
  createdById            String
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime
  assessment_assignments assessment_assignments[]
  assessment_progress    assessment_progress[]
  assessment_questions   assessment_questions[]
  assessment_results     assessment_results[]
  users                  users                    @relation(fields: [createdById], references: [id])

  @@index([isActive])
  @@index([type])
}

model checklist_items {
  id          String    @id
  feedbackId  String
  title       String
  isCompleted Boolean   @default(false)
  order       Int       @default(0)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime
  feedbacks   feedbacks @relation(fields: [feedbackId], references: [id], onDelete: Cascade)
}

model departments {
  id                             String                   @id
  name                           String                   @unique
  description                    String?
  keywords                       String[]
  managerId                      String?
  allowDirectFeedback            Boolean                  @default(false)
  createdAt                      DateTime                 @default(now())
  updatedAt                      DateTime
  canCreateAnnouncement          Boolean                  @default(false)
  allowedAnnouncementDepartments String[]                 @default([])
  allowedPollDepartments         String[]                 @default([])
  canCreatePoll                  Boolean                  @default(false)
  analytics_keywords             analytics_keywords[]
  announcements                  announcements[]
  assessment_assignments         assessment_assignments[]
  employees                      employees[]
  feedbacks                      feedbacks[]
  polls                          polls[]
  tasks                          tasks[]
  users                          users[]
}

model employees {
  id               String             @id
  name             String
  position         String?
  departmentId     String
  createdAt        DateTime           @default(now())
  updatedAt        DateTime
  departments      departments        @relation(fields: [departmentId], references: [id])
  task_assignments task_assignments[]
}

model feedbacks {
  id                                   String            @id
  title                                String
  content                              String
  rating                               Int?
  status                               FeedbackStatus    @default(PENDING)
  isAnonymous                          Boolean           @default(false)
  departmentId                         String
  userId                               String
  forwardedToId                        String?
  forwardedAt                          DateTime?
  completedById                        String?
  completedAt                          DateTime?
  userResponse                         String?
  adminNotes                           String?
  managerNotes                         String?
  deletedAt                            DateTime?
  createdAt                            DateTime          @default(now())
  updatedAt                            DateTime
  image                                String?
  type                                 String            @default("SUGGESTION")
  keywords                             String[]
  checklist_items                      checklist_items[]
  users_feedbacks_completedByIdTousers users?            @relation("feedbacks_completedByIdTousers", fields: [completedById], references: [id])
  departments                          departments       @relation(fields: [departmentId], references: [id])
  users_feedbacks_forwardedToIdTousers users?            @relation("feedbacks_forwardedToIdTousers", fields: [forwardedToId], references: [id])
  users_feedbacks_userIdTousers        users             @relation("feedbacks_userIdTousers", fields: [userId], references: [id])
  messages                             messages[]
  notifications                        notifications[]
  tasks                                tasks?

  // Indexes for common queries
  @@index([status])
  @@index([departmentId])
  @@index([userId])
  @@index([forwardedToId])
  @@index([createdAt])
  @@index([deletedAt])
  @@index([status, departmentId])
  @@index([status, forwardedToId])
}

model messages {
  id         String    @id
  feedbackId String
  senderId   String
  content    String
  isRead     Boolean   @default(false)
  readAt     DateTime?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime
  image      String?
  feedbacks  feedbacks @relation(fields: [feedbackId], references: [id], onDelete: Cascade)
  users      users     @relation(fields: [senderId], references: [id])

  @@index([feedbackId])
  @@index([senderId])
}

model notifications {
  id          String     @id
  userId      String
  feedbackId  String?
  title       String
  content     String
  type        String     @default("INFO")
  isRead      Boolean    @default(false)
  readAt      DateTime?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime
  redirectUrl String?
  feedbacks   feedbacks? @relation(fields: [feedbackId], references: [id], onDelete: Cascade)
  users       users      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([feedbackId])
  @@index([isRead])
  @@index([userId])
}

model otps {
  id        String   @id
  mobile    String
  code      String
  expiresAt DateTime
  verified  Boolean  @default(false)
  createdAt DateTime @default(now())

  @@index([mobile])
}

model poll_options {
  id             String           @id
  pollId         String
  text           String
  order          Int              @default(0)
  createdAt      DateTime         @default(now())
  polls          polls            @relation(fields: [pollId], references: [id], onDelete: Cascade)
  poll_responses poll_responses[]

  @@index([pollId])
}

model poll_responses {
  id           String        @id
  pollId       String
  userId       String
  optionId     String?
  ratingValue  Int?
  textValue    String?
  comment      String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime
  poll_options poll_options? @relation(fields: [optionId], references: [id], onDelete: Cascade)
  polls        polls         @relation(fields: [pollId], references: [id], onDelete: Cascade)
  users        users         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([optionId])
  @@index([pollId])
  @@index([userId])
}

model polls {
  id                 String             @id
  title              String
  description        String?
  type               PollType           @default(SINGLE_CHOICE)
  visibilityMode     PollVisibilityMode @default(PUBLIC)
  isActive           Boolean            @default(true)
  allowMultipleVotes Boolean            @default(false)
  isRequired         Boolean            @default(false)
  showResultsMode    String             @default("LIVE")
  maxTextLength      Int?
  scheduledAt        DateTime?
  publishedAt        DateTime?
  closedAt           DateTime?
  departmentId       String?
  createdById        String
  minRating          Int?
  maxRating          Int?
  createdAt          DateTime           @default(now())
  updatedAt          DateTime
  poll_options       poll_options[]
  poll_responses     poll_responses[]
  users              users              @relation(fields: [createdById], references: [id])
  departments        departments?       @relation(fields: [departmentId], references: [id])
}

model settings {
  id                    String   @id
  siteName              String
  siteDescription       String?
  language              String   @default("fa")
  timezone              String   @default("Asia/Tehran")
  logoUrl               String?
  emailNotifications    Boolean  @default(true)
  smsNotifications      Boolean  @default(false)
  pushNotifications     Boolean  @default(true)
  requirePasswordChange Boolean  @default(false)
  sessionTimeout        Int      @default(30)
  twoFactorAuth         Boolean  @default(false)
  allowAnonymous        Boolean  @default(true)
  autoArchiveDays       Int      @default(90)
  maxFeedbackLength     Int      @default(5000)
  itemsPerPage          Int      @default(20)
  theme                 String   @default("light")
  statusTexts           Json?
  createdAt             DateTime @default(now())
  updatedAt             DateTime
  feedbackTypes         Json?
  notificationSettings  Json?
  chatSettings          Json?
  objectStorageSettings Json?
  workingHoursSettings  Json?
  openAISettings        Json?
  teamStatusSettings    Json?
}

model task_assignments {
  id         String     @id
  taskId     String
  employeeId String?
  userId     String?
  assignedAt DateTime   @default(now())
  employees  employees? @relation(fields: [employeeId], references: [id])
  tasks      tasks      @relation(fields: [taskId], references: [id], onDelete: Cascade)
  users      users?     @relation(fields: [userId], references: [id])

  @@unique([taskId, employeeId])
  @@unique([taskId, userId])
}

model task_comments {
  id        String   @id
  content   String
  taskId    String
  createdAt DateTime @default(now())
  tasks     tasks    @relation(fields: [taskId], references: [id], onDelete: Cascade)
}

model tasks {
  id               String             @id
  title            String
  description      String
  status           TaskStatus         @default(PENDING)
  priority         String?
  isPublic         Boolean            @default(false)
  completedAt      DateTime?
  feedbackId       String?            @unique
  departmentId     String
  createdById      String
  createdAt        DateTime           @default(now())
  updatedAt        DateTime
  task_assignments task_assignments[]
  task_comments    task_comments[]
  users            users              @relation(fields: [createdById], references: [id])
  departments      departments        @relation(fields: [departmentId], references: [id])
  feedbacks        feedbacks?         @relation(fields: [feedbackId], references: [id])
}

model user_statuses {
  id           String     @id
  name         String
  color        String
  allowedRoles UserRole[]
  isActive     Boolean    @default(true)
  order        Int        @default(0)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime
  users        users[]

  @@index([isActive])
  @@index([order])
}

model users {
  id                                       String                  @id
  mobile                                   String                  @unique
  email                                    String?
  name                                     String
  password                                 String
  avatar                                   String?
  role                                     UserRole                @default(EMPLOYEE)
  isActive                                 Boolean                 @default(true)
  departmentId                             String?
  createdAt                                DateTime                @default(now())
  updatedAt                                DateTime
  mustChangePassword                       Boolean                 @default(false)
  statusId                                 String?
  lastSeen                                 DateTime?
  announcement_messages                    announcement_messages[]
  announcement_views                       announcement_views[]
  announcements                            announcements[]
  assessment_progress                      assessment_progress[]
  assessment_results                       assessment_results[]
  assessments                              assessments[]
  feedbacks_feedbacks_completedByIdTousers feedbacks[]             @relation("feedbacks_completedByIdTousers")
  feedbacks_feedbacks_forwardedToIdTousers feedbacks[]             @relation("feedbacks_forwardedToIdTousers")
  feedbacks_feedbacks_userIdTousers        feedbacks[]             @relation("feedbacks_userIdTousers")
  messages                                 messages[]
  notifications                            notifications[]
  poll_responses                           poll_responses[]
  polls                                    polls[]
  task_assignments                         task_assignments[]
  tasks                                    tasks[]
  departments                              departments?            @relation(fields: [departmentId], references: [id])
  user_statuses                            user_statuses?          @relation(fields: [statusId], references: [id])

  // Indexes for common queries
  @@index([role])
  @@index([isActive])
  @@index([departmentId])
  @@index([role, isActive])
  @@index([departmentId, role])
}

enum AssessmentType {
  MBTI
  DISC
  CUSTOM
  HOLLAND
  MSQ
}

enum FeedbackStatus {
  PENDING
  REVIEWED
  ARCHIVED
  DEFERRED
  COMPLETED
}

enum KeywordPriority {
  LOW
  MEDIUM
  HIGH
}

enum KeywordType {
  SENSITIVE
  POSITIVE
  NEGATIVE
  TOPIC
  CUSTOM
}

enum PollType {
  SINGLE_CHOICE
  MULTIPLE_CHOICE
  RATING_SCALE
  TEXT_INPUT
}

enum PollVisibilityMode {
  ANONYMOUS
  PUBLIC
}

enum QuestionType {
  MULTIPLE_CHOICE
  RATING_SCALE
  TRUE_FALSE
  TEXT
}

enum TaskStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  FORWARDED
}

enum UserRole {
  ADMIN
  MANAGER
  EMPLOYEE
}
